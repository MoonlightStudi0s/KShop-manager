# Телеграм-бот для магазина K·Shop

Бот для автоматизации приема и управления заказами игр и сервисов.

## Функциональность

### Клиентская часть
- Прием заказов на игры (с указанием платформы, региона, версии)  
- Прием заказов на игровые сервисы и подписки  
- Прием заявок на пополнение Steam-кошелька  
- Интерактивный интерфейс с инлайн-кнопками

### Административная часть
- Просмотр заказов в виде табличных изображений  
- Экспорт данных в Excel формате  
- Управление базой данных  
- Защищенный доступ к админ-функциям

## Технологический стек
- Python 3.10+  
- pyTelegramBotAPI  
- SQLite3  
- Pillow (PIL) для генерации изображений  
- Pandas + Openpyxl для экспорта в Excel

## Установка и запуск
1. Установите зависимости  
```
pip install pyTelegramBotAPI pillow pandas openpyxl
```
2. Настройте конфигурацию  
- Замените токен бота в строке инициализации  
- Добавьте ID администраторов в список admin_id  
- Подготовьте приветственное изображение welcome.jpg
3. Запустите бота  
```
python bot.py
```

## Структура базы данных
Таблица gameorder  
- uid (INTEGER) — ID пользователя  
- username (TEXT) — имя пользователя  
- game (TEXT) — название игры  
- platform (TEXT) — платформа  
- area (TEXT) — площадка  
- region (TEXT) — регион  
- version (TEXT) — версия игры

Таблица serviceorder  
- uid (INTEGER) — ID пользователя  
- username (TEXT) — имя пользователя  
- service (TEXT) — название сервиса  
- entrance (TEXT) — тип доступа

Таблица steamorder  
- uid (INTEGER) — ID пользователя  
- username (TEXT) — имя пользователя  
- login (TEXT) — логин Steam  
- count (TEXT) — сумма пополнения

## Команды и обработчики

Основные команды  
- /start — инициализация бота, выбор типа заказа  
- /orders — просмотр заказов (только для администраторов)

Callback-обработчики  
- buy_game — обработка заказа игры  
- buy_service — обработка заказа сервиса  
- buy_steam — обработка пополнения Steam  
- admin — вход в админ-панель  
- order — просмотр заказов  
- cleardb — очистка базы данных  
- back_to_lobby — возврат в главное меню

## Особенности реализации

Генерация таблиц  
- Функция create_table_image создает PNG-изображения с таблицами заказов  
- Поддерживает настройку цветовой схемы  
- Автоподбор ширины колонок  
- Заголовки и форматирование

Экспорт в Excel  
- Функция create_excel_file генерирует Excel-файлы с использованием Pandas  
- Excel-файлы формируются в BytesIO для отправки в Telegram

Безопасность  
- Проверка прав администратора по ID  
- Изоляция пользовательских данных  
- Защита от несанкционированного доступа

## Конфигурация

Цветовая схема таблиц  
```python
BG_COLOR = (255, 255, 255)
HEADER_COLOR = (52, 152, 219)
ROW_COLOR = (245, 245, 245)
TEXT_COLOR = (0, 0, 0)
BORDER_COLOR = (200, 200, 200)
```

Шрифты  
- Поиск системных шрифтов в порядке приоритета: arial.ttf  
- fallback на стандартный шрифт

## Важные замечания
- База данных создается автоматически при первом запуске  
- Все изображения генерируются в памяти (in-memory)  
- Excel-файлы создаются через BytesIO для отправки в Telegram  
- Рекомендуется настроить регулярное резервное копирование БД

## Логика работы
- Инициализация БД при запуске  
- Обработка входящих сообщений и callback'ов  
- Валидация и сохранение заказов  
- Генерация отчетов по запросу администратора  
- Непрерывная работа через infinity_polling
